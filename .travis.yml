notifications:
  email: false
sudo: enabled
os: linux
language: python
cache: pip
python: 3.7-dev
env:
  global:
    - OCTOBOT_REPOSITORY="https://github.com/Drakkar-Software/OctoBot"
    - OCTOBOT_REPOSITORY_DIR=OctoBot
install:
  - git clone $OCTOBOT_REPOSITORY $OCTOBOT_REPOSITORY_DIR
  - if [[ $TRAVIS_OS_NAME == 'linux' ]]; then sudo bash ./$OCTOBOT_REPOSITORY_DIR/docs/install/linux_dependencies.sh; fi
  - python3 -m pip install -r requirements.txt
  - cd $OCTOBOT_REPOSITORY_DIR
  - python3 -m pip install -r pre_requirements.txt
  - python3 -m pip install -r requirements.txt -r dev_requirements.txt
  - cp ./config/default_config.json ./config.json
  - python3 start.py -p install all

matrix:
  include:
    - os: osx
      osx_image: xcode8.3
      language: generic
      before_cache:
        - brew cleanup
      cache:
        directories:
          - $HOME/Library/Caches/Homebrew
      before_install:
        - brew update || travis_terminate 1;
        - brew upgrade python || brew install python || travis_terminate 1;
        - python3 -m venv venv || travis_terminate 1;
        - source venv/bin/activate;

    - os: linux
      python: nightly
      language: python

script:
  - cd $TRAVIS_BUILD_DIR
  - mkdir -p ./$OCTOBOT_REPOSITORY_DIR/bin && cp ./bin/start.spec ./$OCTOBOT_REPOSITORY_DIR/bin/start.spec
  - cd $OCTOBOT_REPOSITORY_DIR
  - python3 -m nltk.downloader -d $NLTK_DATA words
  - pyinstaller bin/start.spec
  - mv dist/OctoBot ./OctoBot_$TRAVIS_OS_NAME && rm -rf dist/
  - RELEASE_SHASUM=$(openssl sha1 ./OctoBot_$TRAVIS_OS_NAME)

deploy:
  - provider: releases
    api_key:
      secure: kH0MZaUTCSigXGEEOzpu4Y0iFoWBsjI4eoTQdy4JTWAQ0pp6p3YY4WIvbJRWeQ9xg3WmCCT1KZZQL7jA2VzqLfqNl2qArot3UoGdOPGzhjYPmemIrfrqYsq9Cru0v6X72nHZwv8GfYMRVptzeJCOni8BevmoymH7Y66KqlOOvwgCWjL2PVAhsRMG5FLEvewgXC42N0FZGv+LYQTvr/x2agUkVfUbFT/6yu/y2LroYuAObzx7lQ7HQa9dPo2RG2cdf09rNEI45o8s8s8KCCy+McGyb0XL7Y6rzIPM/JLyiN38bNlkPlE1lvx5HqOvJlLue5fF1ia+2VuxcxHOFuLdi+fd1UevOZMRpZSTyMbqqGSwRcuWqy99RqdWaWPyg+BP8r+iuz78Q1yThcvO+ZloHUuh5q8prbCEb45mieHvEuaXhv4mUklpYXl66C9rFUDwKViD1oKYlYlgpZnJJBBOPTJmCf7ojIDVregNikVHfZMRYtHfQHKoZ9Otb7TeUjOCjXXcMR7lZ1L6ZxFjT/J0FKXBEI1GCqSpbXNoF5b9vo5SZ+982swv0XJll1awIzRk8w7aOz/y0etfb8+taX2e6UVvbncBKyMqdo+mrX/W2V/YZ1RCtcqp6jOMaxn3acK97Og0CRRC1QIPbR6/HA2LuviskuPxekG9Xj/Nuj5o2Pk=
    file: ./OctoBot_$TRAVIS_OS_NAME
    skip_cleanup: true
    name: Release - $TRAVIS_TAG
    body: $RELEASE_SHASUM
    on:
      repo: Drakkar-Software/OctoBot-Binary
      branch: master
      tags: true
